<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Distance Seating Chart Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        input[type="number"], input[type="range"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 80px;
        }

        input[type="range"] {
            width: 200px;
        }

        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: monospace;
        }

        button {
            background-color: #007bff;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            margin-right: 10px;
        }

        button.secondary {
            background-color: #28a745;
        }

        button.secondary:hover {
            background-color: #218838;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .seating-grid {
            display: grid;
            gap: 10px;
            margin-top: 30px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .seat {
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .seat.empty {
            background-color: #e9ecef;
            border-color: #ced4da;
            color: #6c757d;
        }

        .seat.animating {
            background-color: #ffeaa7;
            animation: pulse 0.3s ease-in-out;
        }

        .seat-number {
            position: absolute;
            top: 2px;
            left: 4px;
            font-size: 10px;
            color: #6c757d;
            font-weight: normal;
        }

        .seat {
            position: relative;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .warning {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border: 1px solid #ffeaa7;
        }

        .duration-display {
            font-weight: bold;
            color: #007bff;
        }

        .progress {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background-color: #28a745;
            width: 0%;
            transition: width 0.1s ease;
        }

        .kpi-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }

        .kpi-value {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .kpi-label {
            font-size: 1em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¯ Max Distance Seating Chart Generator</h1>

        <div class="kpi-card">
            <div class="kpi-label">STUDENTS COUNT</div>
            <div class="kpi-value" id="studentCount">0</div>
        </div>

        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label for="rows">Rows:</label>
                    <input type="number" id="rows" min="1" max="20" value="4">
                </div>

                <div class="form-group">
                    <label for="cols">Columns:</label>
                    <input type="number" id="cols" min="1" max="20" value="5">
                </div>

                <div class="form-group">
                    <label for="duration">Animation Duration: <span class="duration-display" id="durationDisplay">5 seconds</span></label>
                    <input type="range" id="duration" min="3" max="10" value="5">
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="showSeatNumbers" checked onchange="toggleSeatNumbers()">
                        Show seat numbers
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label for="students">Student Names (one per line):</label>
                <textarea id="students" placeholder="Enter student names, one per line...
John Smith
Jane Doe
Mike Johnson
Sarah Wilson"></textarea>
            </div>

            <button id="generateBtn" onclick="generateSeatingChart()">Generate Seating Chart</button>
            <button id="exportBtn" class="secondary" onclick="exportToCSV()" style="display: none;">Export to CSV</button>

            <div id="warning" class="warning" style="display: none;"></div>

            <div id="progress" class="progress" style="display: none;">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>

        <div id="seatingChart"></div>
    </div>

    <script>
        let animationInterval;
        let isAnimating = false;

        // Update duration display
        document.getElementById('duration').addEventListener('input', function() {
            const duration = this.value;
            document.getElementById('durationDisplay').textContent = `${duration} seconds`;
        });

        function parseStudents(textareaInput) {
            return textareaInput
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    // Try to detect an explicit separator for id + name:
                    // accept comma, tab, pipe, semicolon, colon, or " - "
                    const parts = line.split(/\t|,|\||;|:| - /).map(p => p.trim()).filter(p => p.length > 0);
                    if (parts.length > 1) {
                        const id = parts[0];
                        const name = parts.slice(1).join(', ');
                        return { id, name };
                    }
                    // No explicit separator -> treat whole line as name (no id)
                    return { id: null, name: line };
                });
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function createGrid(rows, cols) {
            const seatingChart = document.getElementById('seatingChart');
            seatingChart.innerHTML = '';

            const grid = document.createElement('div');
            grid.className = 'seating-grid';
            grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
            grid.style.gridTemplateRows = `repeat(${rows}, 1fr)`;

            for (let i = 0; i < rows * cols; i++) {
                const seat = document.createElement('div');
                seat.className = 'seat';
                seat.id = `seat-${i}`;

                // Add seat number
                const seatNumber = document.createElement('div');
                seatNumber.className = 'seat-number';
                seatNumber.textContent = `#${i + 1}`;
                seatNumber.style.display = document.getElementById('showSeatNumbers').checked ? 'block' : 'none';
                seat.appendChild(seatNumber);

                grid.appendChild(seat);
            }

            seatingChart.appendChild(grid);
            return grid;
        }

        function assignSeats(students, totalSeats) {
            // students is array of objects {id, name}

            // Get grid dimensions from the form
            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);

            // Initialize all seats as empty objects
            const assignments = new Array(totalSeats).fill(null).map(() => ({ id: null, name: 'Empty' }));

            // If no students or no seats, return empty assignments
            if (students.length === 0 || totalSeats === 0) {
                return assignments;
            }

            // Calculate optimal spacing to maximize distance
            // We'll use a strategy that places students as evenly as possible across the grid
            const studentCount = Math.min(students.length, totalSeats);

            // Create a copy of students and shuffle them
            const shuffledStudents = shuffleArray([...students]);

            // Separate odd and even seat indices
            const oddSeats = [];
            const evenSeats = [];

            for (let i = 0; i < totalSeats; i++) {
                if (i % 2 === 0) {
                    evenSeats.push(i);  // 0, 2, 4, 6... (even indices)
                } else {
                    oddSeats.push(i);   // 1, 3, 5, 7... (odd indices)
                }
            }

            // Assign students to odd seats first, then even seats
            let studentIndex = 0;

            // First, assign to odd seats (indices 1, 3, 5, etc.)
            for (let i = 0; i < oddSeats.length && studentIndex < studentCount; i++) {
                assignments[oddSeats[i]] = shuffledStudents[studentIndex];
                studentIndex++;
            }

            // Then, assign to even seats (indices 0, 2, 4, etc.) if there are more students
            for (let i = 0; i < evenSeats.length && studentIndex < studentCount; i++) {
                assignments[evenSeats[i]] = shuffledStudents[studentIndex];
                studentIndex++;
            }

            return assignments;
        }

        function updateSeatingDisplay(assignments) {
            assignments.forEach((entry, index) => {
                const seat = document.getElementById(`seat-${index}`);
                if (seat) {
                    // Clear existing content but preserve seat number
                    const seatNumber = seat.querySelector('.seat-number');
                    seat.innerHTML = '';

                    // Re-add seat number if it existed
                    if (seatNumber) {
                        seat.appendChild(seatNumber);
                    }

                    // Add student name
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = entry.name;
                    seat.appendChild(nameSpan);

                    // Set data attribute for id (empty string if null)
                    seat.dataset.studentId = entry.id || '';

                    // Update seat classes
                    seat.className = entry.name === 'Empty' ? 'seat empty' : 'seat';

                    if (isAnimating) {
                        seat.classList.add('animating');
                    } else {
                        seat.classList.remove('animating');
                    }
                }
            });
        }

        function toggleSeatNumbers() {
            const showNumbers = document.getElementById('showSeatNumbers').checked;
            const seatNumbers = document.querySelectorAll('.seat-number');

            seatNumbers.forEach(seatNumber => {
                seatNumber.style.display = showNumbers ? 'block' : 'none';
            });
        }

        function exportToCSV() {
            const seats = document.querySelectorAll('.seat');
            if (seats.length === 0) {
                showWarning('Please generate a seating chart first before exporting.');
                return;
            }

            // Determine whether any seat has an ID
            const hasIds = Array.from(seats).some(seat => seat.dataset && seat.dataset.studentId && seat.dataset.studentId.trim() !== '');

            const csvData = [];
            if (hasIds) {
                csvData.push(['Seat Number', 'ID', 'Student Name']);
            } else {
                csvData.push(['Seat Number', 'Student Name']);
            }

            seats.forEach((seat, index) => {
                const seatNumber = index + 1;
                const studentNameSpan = seat.querySelector('span');
                const studentName = studentNameSpan ? studentNameSpan.textContent : '';
                const studentId = seat.dataset ? (seat.dataset.studentId || '') : '';

                // Only include seats with students (not empty seats)
                if (studentName && studentName !== 'Empty') {
                    if (hasIds) {
                        csvData.push([seatNumber, studentId, studentName]);
                    } else {
                        csvData.push([seatNumber, studentName]);
                    }
                }
            });

            // Convert to CSV format
            const csvContent = csvData.map(row =>
                row.map(field => `"${field.toString().replace(/"/g, '""')}"`).join(',')
            ).join('\n');

            // Add UTF-8 BOM to ensure Excel reads UTF-8 correctly
            const bom = '\uFEFF';
            const blob = new Blob([bom + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'seating-chart.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function animateShuffle(students, duration) {
            const totalSeats = students.totalSeats;
            const studentNames = students.names;
            let startTime = Date.now();
            let shuffledStudents = [...studentNames];

            const progress = document.getElementById('progress');
            const progressBar = document.getElementById('progressBar');
            progress.style.display = 'block';

            isAnimating = true;

            animationInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const progressPercent = Math.min((elapsed / (duration * 1000)) * 100, 100);
                progressBar.style.width = `${progressPercent}%`;

                if (elapsed >= duration * 1000) {
                    clearInterval(animationInterval);
                    isAnimating = false;
                    progress.style.display = 'none';

                    const finalAssignments = assignSeats(shuffledStudents, totalSeats);
                    updateSeatingDisplay(finalAssignments);

                    document.getElementById('generateBtn').disabled = false;
                    document.getElementById('generateBtn').textContent = 'Generate New Seating Chart';
                    document.getElementById('exportBtn').style.display = 'inline-block';
                    return;
                }

                shuffledStudents = shuffleArray(studentNames);
                const assignments = assignSeats(shuffledStudents, totalSeats);
                updateSeatingDisplay(assignments);
            }, 300);
        }

        function showWarning(message) {
            const warning = document.getElementById('warning');
            warning.textContent = message;
            warning.style.display = 'block';
            setTimeout(() => {
                warning.style.display = 'none';
            }, 5000);
        }

        function generateSeatingChart() {
            if (isAnimating) {
                clearInterval(animationInterval);
                isAnimating = false;
                document.getElementById('progress').style.display = 'none';
            }

            const rows = parseInt(document.getElementById('rows').value);
            const cols = parseInt(document.getElementById('cols').value);
            const duration = parseInt(document.getElementById('duration').value);
            const studentsInput = document.getElementById('students').value;

            // Validation
            if (!rows || !cols || rows < 1 || cols < 1) {
                showWarning('Please enter valid numbers for rows and columns.');
                return;
            }

            if (duration < 3 || duration > 10) {
                showWarning('Animation duration must be between 3 and 10 seconds.');
                return;
            }

            const studentNames = parseStudents(studentsInput);
            const totalSeats = rows * cols;

            if (studentNames.length === 0) {
                showWarning('Please enter at least one student name.');
                return;
            }

            if (studentNames.length > totalSeats) {
                showWarning(`Too many students! You have ${studentNames.length} students but only ${totalSeats} seats. Only the first ${totalSeats} students will be assigned.`);
                studentNames.splice(totalSeats);
            }

            // Update the student count display
            document.getElementById('studentCount').textContent = studentNames.length;

            // Create the grid
            createGrid(rows, cols);

            // Disable button during animation
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('generateBtn').textContent = 'Generating...';

            // Start animation
            animateShuffle({
                names: studentNames,
                totalSeats: totalSeats
            }, duration);
        }

        // Initialize with some sample data
        window.addEventListener('load', function() {
            document.getElementById('students').value = `Alice Johnson
Bob Smith
Carol Davis
David Wilson
Emma Brown
Frank Miller
Grace Taylor
Henry Anderson
Ivy Thomas
Jack White
Kate Green
Liam Clark
Mia Hall
Noah Young
Olivia King
Paul Wright
Quinn Lee
Ruby Scott
Sam Turner
Tina Adams`;

            // Update the student count display with the initial sample data
            const initialStudents = parseStudents(document.getElementById('students').value);
            document.getElementById('studentCount').textContent = initialStudents.length;
        });
    </script>
</body>
</html>